#!/usr/bin/env python

import glob
import os
from subprocess import Popen, PIPE, STDOUT

class Steam(object):
    def __init__(self, raw):
        self.Name = raw[0].split("=")[1]
        self.Command = raw[1].split("=")[1]

    def fmt(self):
        return "{}|{}".format(self.Name, self.Command)

    def map(self):
        return {self.Name: self.Command}

def readSteamNameAndExec(shortcut: str):
    with open(shortcut, 'rb') as f:
        data = f.read().decode("utf-8").split("\n")
        data = [d for d in data if "Exec=" in d or "Name=" in d]
    return Steam(data)

HOME = os.environ['HOME']
STEAM = glob.glob("{}/Desktop/*.desktop".format(HOME))
STEAM = [readSteamNameAndExec(d) for d in STEAM]
STEAM = {d.Name: d.Command for d in STEAM}
keys = list(STEAM.keys())
keys = "\n".join(keys).encode()

p = Popen(['dmenu', '-l', "20", "-i"], stdout=PIPE, stdin=PIPE, stderr=STDOUT)
out = p.communicate(input=keys)[0]
out = out.decode().strip()

Popen(STEAM[out].split())
